<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/favicon.png"/>
	<link rel="shortcut icon" href="/img/favicon.png">
	<meta name="baidu-site-verification" content="code-KLcpk3wnwR" />
	
			<title>趙天一ლ(ﾟдﾟლ)You know、You don’t know</title>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, user-scalable=no"
/>
<link rel="stylesheet" href="/css/mic_main.css" />
<link rel="stylesheet" href="/css/dropdownMenu.css" />
<!-- <script src="/js/live2d/autoload.js"></script> -->

<meta name="keywords" content="Zssaer JavaWeb TIANYI ZHAO" />

<noscript>
  <link rel="stylesheet" href="/css/noscript.css" />
</noscript>
<style type="text/css">
  /* body{
    background: url('https://zssaer.oss-cn-chengdu.aliyuncs.com/wallhaven-r7r551.jpg?x-oss-process=style/wallpaper') center 0 no-repeat;
    content: " ";
    position: fixed;
  } */
  body:before {
    content: " ";
    position: fixed;
    top: 0;
    background: url('https://zssaer.oss-cn-chengdu.aliyuncs.com/wallhaven-r7r551.jpg?x-oss-process=style/wallpaper') center 0 no-repeat;

    right: 0;
    bottom: 0;
    left: 0;
    background-size: cover;
  }
</style>

			    

    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.scrollex.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.scrolly.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/skel.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/util.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/main.js"></script>
	
<meta name="generator" content="Hexo 5.4.0"></head>
    
		<!-- Layouts -->


<!--  代码渲染  -->
<script src="/js/prism.js"></script>
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body
  class=""
  data-prismjs-copy="复制"
  data-prismjs-copy-error="请按Ctrl+C手动复制"
  data-prismjs-copy-success="复制成功!"
>
  <div class="mask-border"></div>
  <!-- Wrapper 外包 s-->
  <div id="wrapper" class="fade-in">
    <!-- Intro 头部显示 s -->
    <!-- Intro 头部显示 e -->
    <!-- Header 头部logo start -->
    <header id="header">
    <a href="/" class="logo">Refrain</a>
</header>
    <!-- Nav 导航条 start -->
    <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">Home</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">Categories</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/C/">C++</a></li><li><a class="category-link" href="/categories/JAVA/">JAVA</a></li><li><a class="category-link" href="/categories/Python/">Python</a></li><li><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></li><li><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li><a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></li><li><a class="category-link" href="/categories/%E6%9D%82%E8%B0%88/">杂谈</a></li><li><a class="category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="AboutMe">
		                AboutMe
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="Wallpaper">
		                Wallpaper
		            </a>
		        </li>
		        
		        <li>
		            <a href="/bangumis/" title="Bangumis">
		                Bangumis
		            </a>
		        </li>
		        
						<li class="active">
							<a href="#s1">Other</a>
											<ul class="submenu">
													<li>
													<a class="category-link" href="/another/billiard.html">台球模拟V1.0</a>
												</li>
											</ul>
						</li>

            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/Zssaer" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="git" href="https://gitee.com/Zssaer01" target="_blank" rel="noopener">
                            <i class="icon fa fa-git"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>
    <aside id="toc_menu"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Nacos-微服务平台框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nacos%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6%E4%B8%8E%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">Nacos基础框架与概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E4%B8%AD%E5%AE%89%E8%A3%85Nacos"><span class="toc-number">1.2.</span> <span class="toc-text">Docker中安装Nacos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E9%9B%86%E7%BE%A4%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.3.</span> <span class="toc-text">部署集群项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%AE%A1%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">配置中心管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">1.5.</span> <span class="toc-text">Nacos集群搭建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E6%96%87Markdown%E6%96%87%E4%BB%B6%E5%9C%A8%E7%BA%BF%E4%B8%8B%E8%BD%BD-https-zssaer-oss-cn-chengdu-aliyuncs-com-markdown-Nacos-md"><span class="toc-number">2.</span> <span class="toc-text">本文Markdown文件在线下载: https:&#x2F;&#x2F;zssaer.oss-cn-chengdu.aliyuncs.com&#x2F;markdown&#x2F;Nacos.md</span></a></li></ol></aside>
    <div id="main">
      
      <div
        class="post_page_title_img"
        style="
          height: 25rem;
          background-image: url(https://zssaer.oss-cn-chengdu.aliyuncs.com/20210820092900.png);
          background-position: center;
          background-repeat: no-repeat;
          background-size: cover;
          -moz-background-size: cover;
          overflow: hidden;
        "
      >
        <a href="#" style="padding: 4rem 4rem 2rem 4rem"
          ><h2 id="page-title">Nacos-微服务平台框架</h2></a
        >
      </div>
      
      <button id="toc_button" onclick="openTocSidebar()">文章导航</button>
      <!-- <div id="content_toc">
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Nacos-微服务平台框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nacos%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6%E4%B8%8E%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">Nacos基础框架与概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E4%B8%AD%E5%AE%89%E8%A3%85Nacos"><span class="toc-number">1.2.</span> <span class="toc-text">Docker中安装Nacos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E9%9B%86%E7%BE%A4%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.3.</span> <span class="toc-text">部署集群项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%AE%A1%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">配置中心管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nacos%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">1.5.</span> <span class="toc-text">Nacos集群搭建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E6%96%87Markdown%E6%96%87%E4%BB%B6%E5%9C%A8%E7%BA%BF%E4%B8%8B%E8%BD%BD-https-zssaer-oss-cn-chengdu-aliyuncs-com-markdown-Nacos-md"><span class="toc-number">2.</span> <span class="toc-text">本文Markdown文件在线下载: https:&#x2F;&#x2F;zssaer.oss-cn-chengdu.aliyuncs.com&#x2F;markdown&#x2F;Nacos.md</span></a></li></ol>
            </div>     -->

      <!-- Post -->
      <div class="typo" style="padding: 3rem"><h1 align = "center">Nacos-微服务平台框架</h1>

<p>Nacos英文全称Dynamic Naming and Configuration Service,是<strong>SpringCloud Alibaba</strong>中的一个重要组件。<strong>主要功能是面向集群管理服务</strong>。</p>
<p>其中Na为naming/nameServer即注册中心,co为configuration即注册中心，service是指该注册/配置中心都是以服务为核心。</p>
<p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/1561217924697-ba504a35-129f-4fc6-b0df-1130b995375a.jpeg"></p>
<p>对标产品的是Netflix的<a target="_blank" rel="noopener" href="http://zssaer.cn/2021/08/04/Eureka/">Eureka</a>，但与Eureka不同的是，Nacos支持AC、AC两种模式，而且在Eureka2.X后，Eureka不再开源，所以目前使用Nacos更为普遍，在学习Nacos之前建议去了解下Eureka。</p>
<p>Nacos支持注册中心和配置中心两种功能,可同时使用。</p>
<p>Nacos不同于其他产品，推荐在Docker中搭建，而不是外部服务器。</p>
<h2 id="Nacos基础框架与概念"><a href="#Nacos基础框架与概念" class="headerlink" title="Nacos基础框架与概念"></a>Nacos基础框架与概念</h2><p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/1561217892717-1418fb9b-7faa-4324-87b9-f1740329f564.jpeg"></p>
<p><strong>服务注册中心 (Service Registry)</strong></p>
<p>服务注册中心，它是服务，其实例及元数据的数据库。服务实例在启动时注册到服务注册表，并在关闭时注销。服务和路由器的客户端查询服务注册表以查找服务的可用实例。服务注册中心可能会调用服务实例的健康检查 API 来验证它是否能够处理请求。</p>
<p><strong>服务 (Service)</strong></p>
<p>服务是指一个或一组软件功能（例如特定信息的检索或一组操作的执行），其目的是不同的客户端可以为不同的目的重用（例如通过跨进程的网络调用）。Nacos 支持主流的服务生态，如 Kubernetes Service、gRPC|Dubbo RPC Service 或者 Spring Cloud RESTful Service。</p>
<p><strong>配置 (Configuration)</strong></p>
<p>在系统开发过程中通常会将一些需要变更的参数、变量等从代码中分离出来独立管理，以独立的配置文件的形式存在。目的是让静态的系统工件或者交付物（如 WAR，JAR 包等）更好地和实际的物理运行环境进行适配。配置管理一般包含在系统部署的过程中，由系统管理员或者运维人员完成这个步骤。配置变更是调整系统运行时的行为的有效手段之一。</p>
<p><strong>配置管理 (Configuration Management)</strong></p>
<p>在数据中心中，系统中所有配置的编辑、存储、分发、变更管理、历史版本管理、变更审计等所有与配置相关的活动统称为配置管理。</p>
<h2 id="Docker中安装Nacos"><a href="#Docker中安装Nacos" class="headerlink" title="Docker中安装Nacos"></a>Docker中安装Nacos</h2><ul>
<li>获取镜像</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker pull nacos/nacos-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>创建并启动镜像</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run -d --name nacos -p <span class="token number">8848</span>:8848 -e <span class="token assign-left variable">PREFER_HOST_MODE</span><span class="token operator">=</span>hostname -e <span class="token assign-left variable">MODE</span><span class="token operator">=</span>standalone nacos/nacos-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>上面使用的是单机模式,单机模式仅限于学习开发使用,正常开发不使用这个模式。</strong></p>
<p>打开<code>http://NacosIP地址:8848/nacos/</code> 进入Nacos页面：</p>
<p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/nacosdl.png"></p>
<p>默认用户名密码都为<code>nacos</code>。</p>
<h2 id="部署集群项目"><a href="#部署集群项目" class="headerlink" title="部署集群项目"></a>部署集群项目</h2><p>不同于Eureka项目那样,因为少了Server注册中心项目,所以直接编写Provide和Customer项目即可。</p>
<p>Provide项目和Customer项目Maven依赖都一样：</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>和Eureka一样，需要在每个项目的启动类上添加@EnableDiscoveryClient注释：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@ServletComponentScan</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>配置配置文件：</p>
<pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">spring:
  application:
    name: service-provider
  cloud:
    nacos:
      discovery:
		# Nacos服务器地址
        server-addr: 192.168.0.101:8848

server:
  port: 8084<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行后即可看见服务器：</p>
<p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/nacos.png"></p>
<p>具体集群开发和<a target="_blank" rel="noopener" href="http://zssaer.cn/2021/08/04/Eureka/">Eureka集群开发</a>也是一样的。</p>
<h2 id="配置中心管理"><a href="#配置中心管理" class="headerlink" title="配置中心管理"></a>配置中心管理</h2><p>Nacos支持配置中心管理，可以管理多个配置文件。</p>
<p>Java项目一般都会有多个Profile配置，用于区分开发环境，测试环境，准生产环境，生成环境等，每个环境对应一个properties文件（或是yml/yaml文件），然后通过设置 spring.profiles.active 的值来决定使用哪个配置文件。</p>
<p>这回首先要在nacos中配置相关的配置，打开Nacos配置界面，依次创建2个Data ID</p>
<ul>
<li>nacos-config-demo-dev.yaml 开发环境的配置</li>
<li>nacos-config-demo-test.yaml 测试环境的配置</li>
</ul>
<p>其中nacos-config-demo为配置文件前缀名,而dev/test为状态,其项目主配置(bootstrap.yml)的spring.profiles.active用作控制项目的运行环境。</p>
<p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/232.png"></p>
<p>在使用Nacos配置中心服务时，服务项目中还需要添加Nacos Config的Maven依赖:</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>编写主配置文件,使用Nacos配置中心，这是项目主配置名必须要使用bootstrap.yml</strong></p>
<p>原因是因为Spring Cloud 构建于 Spring Boot 之上，在 Spring Boot 中有两种上下文，一种是 bootstrap, 另外一种是 application, bootstrap 是应用程序的父上下文，也就是说 bootstrap 加载优先于 applicaton。bootstrap 主要用于从额外的资源来加载配置信息，还可以在本地外部配置文件中解密属性。这两个上下文共用一个环境，它是任何Spring应用程序的外部属性的来源。bootstrap 里面的属性会优先加载，它们默认也不能被本地相同配置覆盖。</p>
<pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">spring:
  application:
    name: nacos-config-demo-provider
  profiles:
    active:  dev
  cloud:
    nacos:
      discovery:
		# nacos的服务器地址
        server-addr: $&#123;NACOS_SERVER:cdh1:8848&#125;
      config:
		# nacos的服务器地址
        server-addr: $&#123;NACOS_SERVER:cdh1:8848&#125;
		# 命名空间地址 -- 如果没配置默认为Public
		namespace: af9b5247-6a3c-443d-a953-ca48662ebaca
		#文件名 -- 如果没有配置则默认为 $&#123;spring.appliction.name&#125;
        prefix: nacos-config-demo
		#指定分组信息 -- 如果没有配置则默认为DEFAULT_GROUP
        group: DEFAULT_GROUP
		#指定文件后缀 -- 如果没有配置则默认为properties
        file-extension: yml
server:
  port: 18083<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意Yaml的配置时的缩进，Yaml文件对缩进是敏感的。</p>
<p><strong>如果Nacos中配置文件采用Yaml文件的话,那么这里的<code>file-extension</code>配置中就应该是<code>yml</code>,而不应该使用<code>yaml</code></strong></p>
<p>对用的Nacos配置文件Data ID的格式如下:<code>$&#123;prefix&#125;-$&#123;spring.profile.active&#125;.$&#123;file-extension&#125;</code></p>
<p>测试配置获取：</p>
<p>创建一个测试的Controller类，用作测试是否获取到Nacos上的存储的配置文件。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/config"</span><span class="token punctuation">)</span>
<span class="token comment">// 打开Nacos配置动态刷新功能</span>
<span class="token annotation punctuation">@RefreshScope</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigGetController</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;name&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">//获取配置的内容</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/name"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"bar is :"</span><span class="token operator">+</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中<code>@RefreshScope</code>为Nacos动态刷新功能,配置后项目的配置文件会实现动态刷新效果,可以实时在Nacos上进行编辑对于环境的配置文件，而不必要重新启动服务器。</p>
<p><strong>多个配置文件管理</strong></p>
<p>对于许多单独服务器的配置来说,我们我可以使用Nacos来统一管理:</p>
<pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">spring:
  application:
    name: nacos-config-demo-provider
  profiles:
    active: dev
  cloud:
    nacos:
      discovery:
        server-addr: $&#123;NACOS_SERVER:cdh1:8848&#125;
      config:
        server-addr: $&#123;NACOS_SERVER:cdh1:8848&#125;
		# 主配置文件前缀
        prefix: nacos-config-demo
        group: DEFAULT_GROUP
        file-extension: yaml
		# 额外配置扩展
        ext-config:
          - data-id: crazymaker-db-dev.yml
            group: DEFAULT_GROUP
            refresh: true
          - data-id: crazymaker-redis-dev.yml
            group: DEFAULT_GROUP
            refresh: true
          - data-id: crazymaker-common-dev.yml
            group: DEFAULT_GROUP
            refresh: true
          - data-id: some.properties
            group: DEFAULT_GROUP
            refresh: true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>对于多个服务项目的配置</strong></p>
<p>多个服务项目配置文件就非常多,为了区分每个服务项目的配置文件,通常在Nacos上创建配置文件时,创建多个命名空间:</p>
<p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/mmkj.png"></p>
<p>默认不配置命名空间的配置文件就会存储在公共的空间<code>public</code>中。</p>
<p>命名空间在配置列表中以上方选项卡进行切换，所以需要切换后在进行配置对于项目的配置文件。</p>
<p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/mmkjqh.png"></p>
<p>配置项目主配置中的<code>namespace</code>，在项目主配置文件中命名空间ID来进行区分，而不是命名空间名称。</p>
<pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">spring:
  application:
    name: service-consumer
  cloud:
    nacos:
      discovery:
        server-addr: 192.168.0.101:8848
      config:
        server-addr: 192.168.0.101:8848
        group: DEFAULT_GROUP
        namespace: af9b5247-6a3c-443d-a953-ca48662ebaca
        file-extension: yml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="Nacos集群搭建"><a href="#Nacos集群搭建" class="headerlink" title="Nacos集群搭建"></a>Nacos集群搭建</h2><p>集群顾名思义多台服务器同享数据，实现高访问量可行性的前提，Nacos作为服务发现中心也必须要实现集群。</p>
<p>前面我们使用的都是standalone单机模式。Nacos服务器并没有进行集群，在单机模式时nacos使用嵌入式数据库实现内部配置数据的存储（当然也可以手动修改为外部数据库进行存储）。</p>
<p>而在正常集群项目中，Nacos需要进行集群配置，并且数据需要进行外部数据库存储。为了在单机上模拟Nacos集群搭建，没必要启动三台服务器，创建三个Docker容器就可以。</p>
<p>进入每个nacos容器的conf目录，编辑application.properties文件，增加外部数据库配置：</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment"># 指定数据源为Mysql</span>
<span class="token attr-name">spring.datasource.platform</span><span class="token punctuation">=</span><span class="token attr-value">mysql</span>

<span class="token comment"># 数据库实例数量</span>
<span class="token attr-name">db.num</span><span class="token punctuation">=</span><span class="token attr-value">1</span>
<span class="token attr-name">db.url.0</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</span>
<span class="token attr-name">db.user</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">db.password</span><span class="token punctuation">=</span><span class="token attr-value">123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>复制代码同样的步骤进入nacos1和nacos2操作一遍，唯一需要单独修改的就是application.properties文件中的<code>server.port</code>配置，假设默认nacos的server.port=8848，那么nacos1修改成8847，nacos2修改成8846。</p>
<p>数据库配置信息好了后，我们需要将对应的数据库和表进行初始化，数据库脚本在conf目录下的nacos-mysql.sql中，执行即可。</p>
<p>最后一步需要配置一份集群节点信息，配置文件在conf目录下的cluster.conf.example文件，我们进行重命名成cluster.conf。 然后编辑cluster.conf文件，增加3个节点的信息，格式为IP:PORT，三个目录都一致即可。</p>
<pre class="line-numbers language-none"><code class="language-none">127.0.0.1:8848
127.0.0.1:8847
127.0.0.1:8846<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>启动的话直接到bin目录下，执行./startup.sh就可以了，默认就是集群模式，不需要加任何参数。</p>
<h1 id="本文Markdown文件在线下载-https-zssaer-oss-cn-chengdu-aliyuncs-com-markdown-Nacos-md"><a href="#本文Markdown文件在线下载-https-zssaer-oss-cn-chengdu-aliyuncs-com-markdown-Nacos-md" class="headerlink" title="本文Markdown文件在线下载: https://zssaer.oss-cn-chengdu.aliyuncs.com/markdown/Nacos.md"></a>本文Markdown文件在线下载: <a target="_blank" rel="noopener" href="https://zssaer.oss-cn-chengdu.aliyuncs.com/markdown/Nacos.md">https://zssaer.oss-cn-chengdu.aliyuncs.com/markdown/Nacos.md</a></h1></div>

      <!-- Post Comments -->
      
    <!-- 使用 changyan -->
<div id="changyan-comment">
    <!--PC和WAP自适应版-->
<div id="SOHUCS" sid="2021/08/20/nacos/"  ></div>
<script type="text/javascript">
(function(){
var appid = 'cyvzq2tmJ';
var conf = 'e61bcf9ca7baef66559e7e33e21fe290';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>

</div>
<style>
    #changyan-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

    </div>
    <!-- Copyright 版权 start -->
    <div id="copyright">
  <ul>
    <li>
      &copy;Powered By
      <a target="_blank" rel="noopener" href="https://hexo.io/" style="border-bottom: none">hexo</a>
    </li>
    <li>Author: <a style="border-bottom: none">@Zssaer</a></li>
  </ul>
  <ul>
    <li>
      <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" id="beian">蜀ICP备2021031070号</a>
    </li>
  </ul>
  
  <span id="busuanzi_container_site_pv"> 2024 </span>
  
</div>

  </div>
  <script>
    const originalTitle = document.title;
    document.title = `Nacos-微服务平台框架` + `|` + originalTitle;
  </script>
</body>



 	
</html>
