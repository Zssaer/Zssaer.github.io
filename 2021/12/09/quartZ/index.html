<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/favicon.png"/>
	<link rel="shortcut icon" href="/img/favicon.png">
	<meta name="baidu-site-verification" content="code-KLcpk3wnwR" />
	
			<title>趙天一ლ(ﾟдﾟლ)You know、You don’t know</title>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, user-scalable=no"
/>
<link rel="stylesheet" href="/css/mic_main.css" />
<link rel="stylesheet" href="/css/dropdownMenu.css" />
<!-- <script src="/js/live2d/autoload.js"></script> -->

<meta name="keywords" content="Zssaer JavaWeb TIANYI ZHAO" />

<noscript>
  <link rel="stylesheet" href="/css/noscript.css" />
</noscript>
<style type="text/css">
  /* body{
    background: url('https://zssaer.oss-cn-chengdu.aliyuncs.com/wallhaven-r7r551.jpg?x-oss-process=style/wallpaper') center 0 no-repeat;
    content: " ";
    position: fixed;
  } */
  body:before {
    content: " ";
    position: fixed;
    top: 0;
    background: url('https://zssaer.oss-cn-chengdu.aliyuncs.com/wallhaven-r7r551.jpg?x-oss-process=style/wallpaper') center 0 no-repeat;

    right: 0;
    bottom: 0;
    left: 0;
    background-size: cover;
  }
</style>

			    

    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.scrollex.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.scrolly.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/skel.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/util.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/main.js"></script>
	
<meta name="generator" content="Hexo 5.4.0"></head>
    
		<!-- Layouts -->


<!--  代码渲染  -->
<script src="/js/prism.js"></script>
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body
  class=""
  data-prismjs-copy="复制"
  data-prismjs-copy-error="请按Ctrl+C手动复制"
  data-prismjs-copy-success="复制成功!"
>
  <div class="mask-border"></div>
  <!-- Wrapper 外包 s-->
  <div id="wrapper" class="fade-in">
    <!-- Intro 头部显示 s -->
    <!-- Intro 头部显示 e -->
    <!-- Header 头部logo start -->
    <header id="header">
    <a href="/" class="logo">Refrain</a>
</header>
    <!-- Nav 导航条 start -->
    <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">Home</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">Categories</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/C/">C++</a></li><li><a class="category-link" href="/categories/JAVA/">JAVA</a></li><li><a class="category-link" href="/categories/Python/">Python</a></li><li><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></li><li><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li><a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></li><li><a class="category-link" href="/categories/%E6%9D%82%E8%B0%88/">杂谈</a></li><li><a class="category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="AboutMe">
		                AboutMe
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="Wallpaper">
		                Wallpaper
		            </a>
		        </li>
		        
		        <li>
		            <a href="/bangumis/" title="Bangumis">
		                Bangumis
		            </a>
		        </li>
		        
						<li class="active">
							<a href="#s1">Other</a>
											<ul class="submenu">
													<li>
													<a class="category-link" href="/another/billiard.html">台球模拟V1.0</a>
												</li>
											</ul>
						</li>

            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/Zssaer" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="git" href="https://gitee.com/Zssaer01" target="_blank" rel="noopener">
                            <i class="icon fa fa-git"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>
    <aside id="toc_menu"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#QuartZ-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%B7%A5%E5%85%B7"><span class="toc-number">1.</span> <span class="toc-text">QuartZ-定时任务调度工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-number">1.2.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E7%B3%BB"><span class="toc-number">1.3.</span> <span class="toc-text">结构体系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">使用教程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%EF%BC%9A%E5%88%9B%E5%BB%BAJob%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%8C%E7%94%A8%E4%BD%9C%E8%AE%BE%E7%BD%AE-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E5%86%85%E5%AE%B9%E3%80%82"><span class="toc-number">1.4.1.</span> <span class="toc-text">一：创建Job实现类，用作设置 定时任务的任务执行内容。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%AE%9A%E4%B9%89%E7%B1%BB%EF%BC%8C%E7%94%A8%E4%BD%9C%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E3%80%82"><span class="toc-number">1.4.2.</span> <span class="toc-text">二：创建一个定时任务定义类，用作快速创建定时任务。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%EF%BC%9A%E5%88%9B%E5%BB%BAQuartz%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E3%80%81%E5%90%AF%E5%8A%A8%E3%80%81%E6%9A%82%E5%81%9C%E3%80%81%E6%81%A2%E5%A4%8D%E3%80%81%E5%88%A0%E9%99%A4%E3%80%81%E4%BF%AE%E6%94%B9%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%96%B9%E6%B3%95%E3%80%82"><span class="toc-number">1.4.3.</span> <span class="toc-text">三：创建Quartz定时任务服务接口，定义创建、启动、暂停、恢复、删除、修改定时任务方法。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%EF%BC%9A%E5%AE%9E%E7%8E%B0Quartz%E5%AE%9A%E6%97%B6%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E3%80%82"><span class="toc-number">1.4.4.</span> <span class="toc-text">四：实现Quartz定时服务接口。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%9A%E6%97%B6%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.4.5.</span> <span class="toc-text">使用定时服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8ECron"><span class="toc-number">1.5.</span> <span class="toc-text">关于Cron</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E8%BD%AC%E5%8C%96%E4%B8%BACron"><span class="toc-number">1.5.1.</span> <span class="toc-text">日期时间转化为Cron</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E5%86%85%E5%AE%B9"><span class="toc-number">1.6.</span> <span class="toc-text">详细内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Job%E5%B9%B6%E5%8F%91"><span class="toc-number">1.6.1.</span> <span class="toc-text">Job并发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Job%E5%BC%82%E5%B8%B8"><span class="toc-number">1.6.2.</span> <span class="toc-text">Job异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8EScheduler"><span class="toc-number">1.6.3.</span> <span class="toc-text">关于Scheduler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JobDataMap"><span class="toc-number">1.6.4.</span> <span class="toc-text">JobDataMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trigger"><span class="toc-number">1.6.5.</span> <span class="toc-text">Trigger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Quartz%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.6.6.</span> <span class="toc-text">Quartz持久化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot-Quartz%E9%9B%86%E6%88%90"><span class="toc-number">1.7.</span> <span class="toc-text">SpringBoot-Quartz集成</span></a></li></ol></li></ol></aside>
    <div id="main">
      
      <div
        class="post_page_title_img"
        style="
          height: 25rem;
          background-image: url(https://zssaer.oss-cn-chengdu.aliyuncs.com/wallhaven-4d71wl.jpg?x-oss-process=style/wallpaper);
          background-position: center;
          background-repeat: no-repeat;
          background-size: cover;
          -moz-background-size: cover;
          overflow: hidden;
        "
      >
        <a href="#" style="padding: 4rem 4rem 2rem 4rem"
          ><h2 id="page-title">QuartZ-定时任务调度工具</h2></a
        >
      </div>
      
      <button id="toc_button" onclick="openTocSidebar()">文章导航</button>
      <!-- <div id="content_toc">
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#QuartZ-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E5%B7%A5%E5%85%B7"><span class="toc-number">1.</span> <span class="toc-text">QuartZ-定时任务调度工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-number">1.2.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E7%B3%BB"><span class="toc-number">1.3.</span> <span class="toc-text">结构体系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">使用教程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%EF%BC%9A%E5%88%9B%E5%BB%BAJob%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%8C%E7%94%A8%E4%BD%9C%E8%AE%BE%E7%BD%AE-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E5%86%85%E5%AE%B9%E3%80%82"><span class="toc-number">1.4.1.</span> <span class="toc-text">一：创建Job实现类，用作设置 定时任务的任务执行内容。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%AE%9A%E4%B9%89%E7%B1%BB%EF%BC%8C%E7%94%A8%E4%BD%9C%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E3%80%82"><span class="toc-number">1.4.2.</span> <span class="toc-text">二：创建一个定时任务定义类，用作快速创建定时任务。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%EF%BC%9A%E5%88%9B%E5%BB%BAQuartz%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E3%80%81%E5%90%AF%E5%8A%A8%E3%80%81%E6%9A%82%E5%81%9C%E3%80%81%E6%81%A2%E5%A4%8D%E3%80%81%E5%88%A0%E9%99%A4%E3%80%81%E4%BF%AE%E6%94%B9%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%96%B9%E6%B3%95%E3%80%82"><span class="toc-number">1.4.3.</span> <span class="toc-text">三：创建Quartz定时任务服务接口，定义创建、启动、暂停、恢复、删除、修改定时任务方法。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%EF%BC%9A%E5%AE%9E%E7%8E%B0Quartz%E5%AE%9A%E6%97%B6%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E3%80%82"><span class="toc-number">1.4.4.</span> <span class="toc-text">四：实现Quartz定时服务接口。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%9A%E6%97%B6%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.4.5.</span> <span class="toc-text">使用定时服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8ECron"><span class="toc-number">1.5.</span> <span class="toc-text">关于Cron</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E8%BD%AC%E5%8C%96%E4%B8%BACron"><span class="toc-number">1.5.1.</span> <span class="toc-text">日期时间转化为Cron</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E5%86%85%E5%AE%B9"><span class="toc-number">1.6.</span> <span class="toc-text">详细内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Job%E5%B9%B6%E5%8F%91"><span class="toc-number">1.6.1.</span> <span class="toc-text">Job并发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Job%E5%BC%82%E5%B8%B8"><span class="toc-number">1.6.2.</span> <span class="toc-text">Job异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8EScheduler"><span class="toc-number">1.6.3.</span> <span class="toc-text">关于Scheduler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JobDataMap"><span class="toc-number">1.6.4.</span> <span class="toc-text">JobDataMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trigger"><span class="toc-number">1.6.5.</span> <span class="toc-text">Trigger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Quartz%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.6.6.</span> <span class="toc-text">Quartz持久化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot-Quartz%E9%9B%86%E6%88%90"><span class="toc-number">1.7.</span> <span class="toc-text">SpringBoot-Quartz集成</span></a></li></ol></li></ol>
            </div>     -->

      <!-- Post -->
      <div class="typo" style="padding: 3rem"><h1 id="QuartZ-定时任务调度工具"><a href="#QuartZ-定时任务调度工具" class="headerlink" title="QuartZ-定时任务调度工具"></a>QuartZ-定时任务调度工具</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/quartz.jpg"></p>
<p>Quartz是一款Java开源定时任务调度项目，Quartz可以用来创建简单或为运行十个，百个，甚至是好几万个Jobs这样复杂的定时任务程序。适合作用于JAVA定时任务中。</p>
<p>它的主要功能就是定时创建一个实现org.quartz.Job接口的java类。Job接口包含唯一的方法：execute，它来执行定时任务中的任务。当调度程序确定该是通知你的作业的时候，Quartz框架将调用你Job实现类（作业类）上的execute()方法并允许做它该做的事情。无需报告任何东西给调度器或调用任何特定的东西。如果配置你的作业在随后再次被调用，Quartz框架将在恰当的时间再次调用它，从而达到反复作业的效果。</p>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><p>Quartz框架的核心是调度器。调度器负责管理Quartz应用运行时环境。调度器不是靠自己做所有的工作，而是依赖框架内一些非常重要的部件。Quartz不仅仅是线程和线程管理。为确保可伸缩性，Quartz采用了基于<strong>多线程</strong>的架构。</p>
<p>Quartz应用支持集群配置，是水平集群还是垂直集群取决于你自己的需要。集群提供以下好处：</p>
<p>·伸缩性</p>
<p>·高可用性</p>
<p>·负载均衡</p>
<p>Quartz可以借助关系数据库和JDBC作业存储支持集群。</p>
<h2 id="结构体系"><a href="#结构体系" class="headerlink" title="结构体系"></a>结构体系</h2><p>Quartz的结构体系如下：</p>
<p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/1107379-20210106120720081-661749954.png"></p>
<p>Quartz的重要组成:</p>
<ul>
<li><p>Job</p>
<p>它是一个接口,只有一个方法<code>void execute(JobExecutionContext context)</code>，开发者可以实现该接口定义运行任务，相当于TimerTask下面的run()方法。它拥有一个参数<code>JobExecutionContext</code>，<code>JobExecutionContext</code>提供了调度上下文的各种信息可以使用它来获取JobDetail中JobDataMap来获取任务参数等。</p>
</li>
<li><p>JobDetail</p>
<p>JobDetail包含了任务的Job实现类，用作任务的实现，也包含了该任务的名称和组名，也可以从用作参数的保存(JobData)。</p>
</li>
<li><p>Trigger</p>
<p>任务的触发器,表明job任务什么时候被调用,描述触发的job执行时的时间触发规则；主要有SimpleTrigger和CronTrigger两个子类。</p>
<p>当仅触发一次或者以固定时间间隔周期执行时，使用SimpleTrigger；CronTrigger通过cron表达式，定义出各种复杂时间规则的调度方案。</p>
</li>
<li><p>Scheduler</p>
<p>Quartz的调度器，代表Quartz的一个独立运行容器。Trigger和JobDetail可以注册到Scheduler中，两者在Scheduler中拥有各自的组及名称，组及名称是Scheduler查找定位容器中某一对象的依据，所以<strong>Trigger的组及名称必须唯一，JobDetail的组和名称也必须唯一。（但可以和Trigger的组和名称相同，因为它们是不同类型的）。</strong></p>
<p>Scheduler可以将Trigger绑定到某一JobDetail中，这样当Trigger触发时，对应的Job就被执行。</p>
<p>一个Job可以对应多个Trigger，但一个Trigger只能对应一个Job。</p>
</li>
</ul>
<h2 id="使用教程"><a href="#使用教程" class="headerlink" title="使用教程"></a>使用教程</h2><p>本文使用<code>spring-boot-starter-quartz</code>依赖包，它是SpringBoot官方与Quartz的整合依赖包，比起原版Quartz依赖包更加适合SpringBoot的整合。</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-quartz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.5.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="一：创建Job实现类，用作设置-定时任务的任务执行内容。"><a href="#一：创建Job实现类，用作设置-定时任务的任务执行内容。" class="headerlink" title="一：创建Job实现类，用作设置 定时任务的任务执行内容。"></a>一：创建Job实现类，用作设置 定时任务的任务执行内容。</h3>  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * @description: XXX定时任务执行逻辑
 * @author: Zhaotianyi
 * @time: 2021/10/12 14:24
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XxxJob</span> <span class="token keyword">extends</span> <span class="token class-name">QuartzJobBean</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">SayHelloJobLogic</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">executeInternal</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> jobExecutionContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//写你自己的逻辑</span>
        <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> jobExecutionContext<span class="token punctuation">.</span><span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JobDataMap</span> jobDataMap <span class="token operator">=</span> jobDetail<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token class-name">JobKey</span> key <span class="token operator">=</span> jobDetail<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" 定时任务执行完毕!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><em>注意：由于本文使用的是<code>spring-boot-starter-quartz</code>依赖包，所以Job实现类可以继承其QuartzJobBean,而不是实现<code>Job</code>接口，其中<code>executeInternal</code>方法也与原本的<code>execute</code>方法效果一致。</em></p>
<h3 id="二：创建一个定时任务定义类，用作快速创建定时任务。"><a href="#二：创建一个定时任务定义类，用作快速创建定时任务。" class="headerlink" title="二：创建一个定时任务定义类，用作快速创建定时任务。"></a>二：创建一个定时任务定义类，用作快速创建定时任务。</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * @description: 定时任务类
 * @author: Zhaotianyi
 * @time: 2021/10/12 14:24
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskDefine</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * 定时任务 的名字和分组名 JobKey,&#123;@link org.quartz.JobKey&#125;
     */</span>
    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"定时任务的 名字 和 组名 坚决不为空"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">JobKey</span> jobKey<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 定时任务 的描述(可以定时任务本身的描述,也可以是触发器的)
     * &#123;@link org.quartz.JobDetail&#125; description ; &#123;@link org.quartz.Trigger&#125; description
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 定时任务 的执行cron (Trigger的CronScheduleBuilder 的cronExpression)
     * 定义执行时间条件
     * &#123;@link org.quartz.Trigger&#125; CronScheduleBuilder &#123;@link org.quartz.CronScheduleBuilder&#125;
     */</span>
    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"定时任务的执行cron 不能为空"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> cronExpression<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 定时任务 的传输数据
     * 用作传输任务参数给Job类
     * &#123;@link org.quartz.JobDataMap&#125;
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">></span></span> jobDataMap<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 定时任务 的 具体执行逻辑类/Job
     * &#123;@link org.quartz.Job&#125;
     */</span>
    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"定时任务的具体执行逻辑类 坚决不能为空"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Job</span><span class="token punctuation">></span></span> jobClass<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TaskDefine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">TaskDefine</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">,</span> <span class="token class-name">String</span> description<span class="token punctuation">,</span> <span class="token class-name">String</span> cronExpression<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">></span></span> jobDataMap<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Job</span><span class="token punctuation">></span></span> jobClass<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jobKey <span class="token operator">=</span> jobKey<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>description <span class="token operator">=</span> description<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cronExpression <span class="token operator">=</span> cronExpression<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jobDataMap <span class="token operator">=</span> jobDataMap<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jobClass <span class="token operator">=</span> jobClass<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// Getting/Setting方法</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="三：创建Quartz定时任务服务接口，定义创建、启动、暂停、恢复、删除、修改定时任务方法。"><a href="#三：创建Quartz定时任务服务接口，定义创建、启动、暂停、恢复、删除、修改定时任务方法。" class="headerlink" title="三：创建Quartz定时任务服务接口，定义创建、启动、暂停、恢复、删除、修改定时任务方法。"></a>三：创建Quartz定时任务服务接口，定义创建、启动、暂停、恢复、删除、修改定时任务方法。</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * @description: 定时任务服务
 * @author: Zhaotianyi
 * @time: 2021/10/12 14:15
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">QuartzJobService</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * 创建和启动 定时任务
     */</span>
    <span class="token keyword">void</span> <span class="token function">scheduleJob</span><span class="token punctuation">(</span><span class="token class-name">TaskDefine</span> define<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 暂停Job
     */</span>
    <span class="token keyword">void</span> <span class="token function">pauseJob</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 恢复Job
     */</span>
    <span class="token keyword">void</span> <span class="token function">resumeJob</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 删除Job
     */</span>
    <span class="token keyword">void</span> <span class="token function">deleteJob</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 修改现存在的Job触发器 的cron表达式
     */</span>
    <span class="token keyword">boolean</span> <span class="token function">modifyJobCron</span><span class="token punctuation">(</span><span class="token class-name">TaskDefine</span> define<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="四：实现Quartz定时服务接口。"><a href="#四：实现Quartz定时服务接口。" class="headerlink" title="四：实现Quartz定时服务接口。"></a>四：实现Quartz定时服务接口。</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * @description: 定时任务实现服务类
 * @author: Zhaotianyi
 * @time: 2021/10/14 10:16:55
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzJobServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">QuartzJobService</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">QuartzJobServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">QuartzJobServiceImpl</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">SchedulerFactoryBean</span> schedulerFactoryBean<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        scheduler <span class="token operator">=</span> schedulerFactoryBean<span class="token punctuation">.</span><span class="token function">getScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 创建和启动 定时任务
     * &#123;@link org.quartz.Scheduler#scheduleJob(JobDetail, Trigger)&#125;
     *
     * @param define 定时任务定义类
     * @throws SchedulerException 定时任务错误
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">scheduleJob</span><span class="token punctuation">(</span><span class="token class-name">TaskDefine</span> define<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//1.定时任务 的 名字和组名</span>
        <span class="token class-name">JobKey</span> jobKey <span class="token operator">=</span> define<span class="token punctuation">.</span><span class="token function">getJobKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.定时任务 的 元数据</span>
        <span class="token class-name">JobDataMap</span> jobDataMap <span class="token operator">=</span> <span class="token function">getJobDataMap</span><span class="token punctuation">(</span>define<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.定时任务 的 描述</span>
        <span class="token class-name">String</span> description <span class="token operator">=</span> define<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.定时任务 的 逻辑实现类</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Job</span><span class="token punctuation">></span></span> jobClass <span class="token operator">=</span> define<span class="token punctuation">.</span><span class="token function">getJobClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.定时任务 的 cron表达式</span>
        <span class="token class-name">String</span> cron <span class="token operator">=</span> define<span class="token punctuation">.</span><span class="token function">getCronExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//用1-5获取的数据 来 组装 定时任务Job</span>
        <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> <span class="token function">getJobDetail</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">,</span> description<span class="token punctuation">,</span> jobDataMap<span class="token punctuation">,</span> jobClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//用1-5获取的数据 来 组装 定时任务触发器</span>
        <span class="token class-name">Trigger</span> trigger <span class="token operator">=</span> <span class="token function">getTrigger</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">,</span> description<span class="token punctuation">,</span> jobDataMap<span class="token punctuation">,</span> cron<span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 暂停Job
     * &#123;@link org.quartz.Scheduler#pauseJob(JobKey)&#125;
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pauseJob</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span> <span class="token punctuation">&#123;</span>
        scheduler<span class="token punctuation">.</span><span class="token function">pauseJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 恢复Job
     * &#123;@link org.quartz.Scheduler#resumeJob(JobKey)&#125;
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resumeJob</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span> <span class="token punctuation">&#123;</span>
        scheduler<span class="token punctuation">.</span><span class="token function">resumeJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 删除Job
     * &#123;@link org.quartz.Scheduler#deleteJob(JobKey)&#125;
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteJob</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span> <span class="token punctuation">&#123;</span>
        scheduler<span class="token punctuation">.</span><span class="token function">deleteJob</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 修改现存在的Job触发器内容
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">modifyJobCron</span><span class="token punctuation">(</span><span class="token class-name">TaskDefine</span> define<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> cronExpression <span class="token operator">=</span> define<span class="token punctuation">.</span><span class="token function">getCronExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1.如果cron表达式的格式不正确,则返回修改失败</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CronExpression</span><span class="token punctuation">.</span><span class="token function">isValidExpression</span><span class="token punctuation">(</span>cronExpression<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">JobKey</span> jobKey <span class="token operator">=</span> define<span class="token punctuation">.</span><span class="token function">getJobKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TriggerKey</span> triggerKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TriggerKey</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> jobKey<span class="token punctuation">.</span><span class="token function">getGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">CronTrigger</span> cronTrigger <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">CronTrigger</span><span class="token punctuation">)</span> scheduler<span class="token punctuation">.</span><span class="token function">getTrigger</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">JobDataMap</span> jobDataMap <span class="token operator">=</span> <span class="token function">getJobDataMap</span><span class="token punctuation">(</span>define<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cronTrigger <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token comment">//2.如果cron发生变化了,则按新cron触发 进行重新启动定时任务</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cronTrigger<span class="token punctuation">.</span><span class="token function">getCronExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>cronExpression<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">CronTrigger</span> trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">CronScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span>cronExpression<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span>jobDataMap<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                scheduler<span class="token punctuation">.</span><span class="token function">rescheduleJob</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"printStackTrace"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token comment">/**
     * 获取定时任务中元数据
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">JobDataMap</span> <span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">></span></span> map<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> map <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">JobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">JobDataMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 获取定时任务的定义
     * JobDetail是任务的定义,Job是任务的执行逻辑
     *
     * @param jobKey      定时任务的名称 组名
     * @param description 定时任务的 描述
     * @param jobDataMap  定时任务的 元数据
     * @param jobClass    &#123;@link org.quartz.Job&#125; 定时任务的 真正执行逻辑定义类
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">JobDetail</span> <span class="token function">getJobDetail</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">,</span> <span class="token class-name">String</span> description<span class="token punctuation">,</span> <span class="token class-name">JobDataMap</span> jobDataMap<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Job</span><span class="token punctuation">></span></span> jobClass<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span>jobClass<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withDescription</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setJobData</span><span class="token punctuation">(</span>jobDataMap<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span>jobDataMap<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">requestRecovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">storeDurably</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * 获取Trigger (Job的触发器,执行规则)
     *
     * @param jobKey         定时任务的名称 组名
     * @param description    定时任务的 描述
     * @param jobDataMap     定时任务的 元数据
     * @param cronExpression 定时任务的 执行cron表达式
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Trigger</span> <span class="token function">getTrigger</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span> jobKey<span class="token punctuation">,</span> <span class="token class-name">String</span> description<span class="token punctuation">,</span> <span class="token class-name">JobDataMap</span> jobDataMap<span class="token punctuation">,</span> <span class="token class-name">String</span> cronExpression<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>jobKey<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> jobKey<span class="token punctuation">.</span><span class="token function">getGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withDescription</span><span class="token punctuation">(</span>description<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span><span class="token class-name">CronScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span>cronExpression<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">usingJobData</span><span class="token punctuation">(</span>jobDataMap<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="使用定时服务"><a href="#使用定时服务" class="headerlink" title="使用定时服务"></a>使用定时服务</h3><p>最后：我们只需要在需要开启定时服务的服务中使用即可：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Created by zty on 2021/08/26.
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XXXServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">XXXService</span> <span class="token punctuation">&#123;</span>
	<span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">QuartzJobService</span> quartzJobService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">xxx</span><span class="token punctuation">(</span><span class="token class-name">XxxReq</span> req<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span> <span class="token punctuation">&#123;</span>
    	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    	<span class="token comment">//定义定时任务</span>
        <span class="token class-name">TaskDefine</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskDefine</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span><span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>getname <span class="token operator">+</span> <span class="token string">" Job"</span><span class="token punctuation">,</span> <span class="token string">"GroupOne"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"这是一个"</span> <span class="token operator">+</span> loginName <span class="token operator">+</span> <span class="token string">"的定时注册任务"</span><span class="token punctuation">,</span>       <span class="token comment">//定时任务 的描述</span>
                cron<span class="token punctuation">,</span>           <span class="token comment">//定时任务 的cron表达式</span>
                data<span class="token punctuation">,</span>			<span class="token comment">// 定时任务的参数数据</span>
                <span class="token class-name">XxxJob</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token comment">//定时任务 的具体执行逻辑</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 调度器设置定时任务</span>
        quartzJobService<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">xxx</span><span class="token punctuation">(</span><span class="token class-name">XxxReq</span> req<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span> <span class="token punctuation">&#123;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">// 暂停指定定时任务    </span>
        quartzJobService<span class="token punctuation">.</span><span class="token function">pauseJob</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span><span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>getname <span class="token operator">+</span> <span class="token string">" Job"</span><span class="token punctuation">,</span> <span class="token string">"GroupOne"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">xxx</span><span class="token punctuation">(</span><span class="token class-name">XxxReq</span> req<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SchedulerException</span> <span class="token punctuation">&#123;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">// 修改现存在的Job触发器内容</span>
        <span class="token class-name">TaskDefine</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TaskDefine</span><span class="token punctuation">(</span><span class="token class-name">JobKey</span><span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>getname <span class="token operator">+</span> <span class="token string">" Job"</span><span class="token punctuation">,</span> <span class="token string">"GroupOne"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"这是一个"</span> <span class="token operator">+</span> loginName <span class="token operator">+</span> <span class="token string">"的定时注册任务"</span><span class="token punctuation">,</span>       <span class="token comment">//定时任务 的描述</span>
                newCron<span class="token punctuation">,</span>           <span class="token comment">//定时任务 的cron表达式</span>
                data<span class="token punctuation">,</span>			<span class="token comment">// 定时任务的参数数据</span>
                <span class="token class-name">XxxJob</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token comment">//定时任务 的具体执行逻辑</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        quartzJobService<span class="token punctuation">.</span><span class="token function">modifyJobCron</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>从上例使用，我们可以看出，要定义一个任务，需要干几件事：</p>
<ol>
<li>创建一个org.quartz.Job的实现类，并实现实现自己的业务逻辑。比如上面的DoNothingJob。</li>
<li>定义一个JobDetail，引用这个实现类。</li>
<li>定义一个trigger，用来定义触发条件。</li>
<li>将其JobDetail，trigger加入schedule调度器中。</li>
</ol>
<p>上面的使用中，我们定义了<code>TaskDefine</code>定时任务定义类,这样每次创建定时任务时只需要创建一个<code>TaskDefine</code>并传入服务类即可,服务类自动将其定义JobDetail、trigger，减少编写代码的重复，加快开发速度。</p>
<h2 id="关于Cron"><a href="#关于Cron" class="headerlink" title="关于Cron"></a>关于Cron</h2><p>Cron是Linux中一个定时执行工具,而在其Quartz中的Cron是一种Cron表达式,是一个字符串，字符串以5或6个空格隔开，分为6或7个域，每一个域代表一个含义。一般来说难以理解以及换算，</p>
<p>Cron表达式对特殊字符的大小写不敏感，对代表星期的缩写英文大小写也不敏感。</p>
<p>有Cron表达式一些例子：</p>
<table>
<thead>
<tr>
<th>表示式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>0 0 12 * * ?</td>
<td>每天12点运行</td>
</tr>
<tr>
<td>0 15 10 ? * *</td>
<td>每天10:15运行</td>
</tr>
<tr>
<td>0 15 10 * * ?</td>
<td>每天10:15运行</td>
</tr>
<tr>
<td>0 15 10 * * ? *</td>
<td>每天10:15运行</td>
</tr>
<tr>
<td>0 15 10 * * ? 2008</td>
<td>在2008年的每天10：15运行</td>
</tr>
<tr>
<td>0 * 14 * * ?</td>
<td>每天14点到15点之间每分钟运行一次，开始于14:00，结束于14:59。</td>
</tr>
<tr>
<td>0 0/5 14 * * ?</td>
<td>每天14点到15点每5分钟运行一次，开始于14:00，结束于14:55。</td>
</tr>
<tr>
<td>0 0/5 14,18 * * ?</td>
<td>每天14点到15点每5分钟运行一次，此外每天18点到19点每5钟也运行一次。</td>
</tr>
<tr>
<td>0 0-5 14 * * ?</td>
<td>每天14:00点到14:05，每分钟运行一次。</td>
</tr>
<tr>
<td>0 10,44 14 ? 3 WED</td>
<td>3月每周三的14:10分到14:44，每分钟运行一次。</td>
</tr>
<tr>
<td>0 15 10 ? * MON-FRI</td>
<td>每周一，二，三，四，五的10:15分运行。</td>
</tr>
<tr>
<td>0 15 10 15 * ?</td>
<td>每月15日10:15分运行。</td>
</tr>
<tr>
<td>0 15 10 L * ?</td>
<td>每月最后一天10:15分运行。</td>
</tr>
<tr>
<td>0 15 10 ? * 6L</td>
<td>每月最后一个星期五10:15分运行。</td>
</tr>
<tr>
<td>0 15 10 ? * 6L 2007-2009</td>
<td>在2007,2008,2009年每个月的最后一个星期五的10:15分运行。</td>
</tr>
<tr>
<td>0 15 10 ? * 6#3</td>
<td>每月第三个星期五的10:15分运行。</td>
</tr>
</tbody></table>
<p>为了方便计算出准确的Cron表达式，我们通常使用<a target="_blank" rel="noopener" href="https://cron.qqe2.com/%E5%9C%A8%E7%BA%BFCron%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%94%9F%E6%88%90%E3%80%82">https://cron.qqe2.com/在线Cron表达式生成。</a></p>
<h3 id="日期时间转化为Cron"><a href="#日期时间转化为Cron" class="headerlink" title="日期时间转化为Cron"></a>日期时间转化为Cron</h3><p>对于用户要求自定义设置时间来设置定时任务来说，可以创建一个简易的Cron生成工具类<code>CronUtils</code>：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * @description: Cron生成工具类
 * @author: Zhaotianyi
 * @time: 2021/10/12 16:25
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CronUtils</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"ss mm HH dd MM ? yyyy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/***
     *  功能描述：格式化日期Cron
     * @param date 日期
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">formatDateByPattern</span><span class="token punctuation">(</span><span class="token class-name">Date</span> date<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> formatTimeStr <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            formatTimeStr <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> formatTimeStr<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/***
     *  功能描述：格式化日期Cron
     * @param localDateTime 日期
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">formatDateByPattern</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span> localDateTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> formatTimeStr <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>localDateTime<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            formatTimeStr <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"ss mm HH dd MM ? yyyy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> formatTimeStr<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/***
     * Data转换至Conrn
     * convert Date to cron, eg "0 07 10 15 1 ? 2016"
     * @param date  : 时间点
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getCron</span><span class="token punctuation">(</span><span class="token class-name">Date</span> date<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">formatDateByPattern</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/***
     * LocalDateTime转换至Conrn
     * convert Date to cron, eg "0 07 10 15 1 ? 2016"
     * @param localDateTime  : 时间点
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getCron</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span> localDateTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">formatDateByPattern</span><span class="token punctuation">(</span>localDateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过<code>CronUtils</code>工具类的<code>getCron</code>方法即可以实现日期转化为Cron表达式。</p>
<h2 id="详细内容"><a href="#详细内容" class="headerlink" title="详细内容"></a>详细内容</h2><h3 id="Job并发"><a href="#Job并发" class="headerlink" title="Job并发"></a>Job并发</h3><p>定时任务Job是有可能并发执行的，比如一个任务要执行10秒中，而调度算法是每秒中触发1次，那么就有可能多个任务被并发执行。</p>
<p>有时候我们并不想任务并发执行，比如有个任务要去”获得数据库中所有未发送邮件的名单“，如果是并发执行，就需要一个数据库锁去避免一个数据被多次处理。这个时候一个使用<code>@DisallowConcurrentExecution</code>解决这个问题。表示该Job为异步过程,不允许同步运行，运行时其他任务进入等待。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XxxJob</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@DisallowConcurrentExecution</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">&#123;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意，**@DisallowConcurrentExecution是对JobDetail实例生效**，也就是如果你定义两个JobDetail，引用同一个Job类，是可以并发执行的。</p>
<h3 id="Job异常"><a href="#Job异常" class="headerlink" title="Job异常"></a>Job异常</h3><p>Job.execute()方法是不允许抛出除JobExecutionException之外的所有异常的（包括RuntimeException)，所以编码的时候，最好是try-catch住所有的Throwable，小心处理。</p>
<h3 id="关于Scheduler"><a href="#关于Scheduler" class="headerlink" title="关于Scheduler"></a>关于Scheduler</h3><p>Scheduler就是Quartz的大脑，所有定时任务都是由它来设施和存储的。</p>
<p>Scheduler包含一个两个重要组件: <strong>JobStore</strong>和<strong>ThreadPool</strong>。</p>
<ul>
<li>JobStore是会来存储运行时信息的，包括Trigger,Schduler,JobDetail，业务锁等。它有多种实现RAMJob(内存实现)，JobStoreTX(JDBC，事务由Quartz管理），JobStoreCMT(JDBC，使用容器事务)，ClusteredJobStore(集群实现)、TerracottaJobStore(<a target="_blank" rel="noopener" href="http://yale.iteye.com/blog/1541612">什么是Terractta</a>)。</li>
<li>ThreadPool顾名思义就是线程池，Quartz有自己的线程池实现。所有任务的都会由线程池执行。</li>
</ul>
<h3 id="JobDataMap"><a href="#JobDataMap" class="headerlink" title="JobDataMap"></a>JobDataMap</h3><p>JobDataMap中可以包含不限量的（序列化的）数据对象，在job实例执行的时候，可以使用其中的数据；JobDataMap是Java Map接口的一个实现，额外增加了一些便于存取基本类型的数据的方法。</p>
<p>如果你Quartz使用的是持久化的存储机制，在决定JobDataMap中存放什么数据的时候需要小心，因为JobDataMap中存储的对象都会被序列化。</p>
<p>通常我们在Job实现类中获取JobDataMap时使用Map 中Get方法获取对应需求的数据，这样会显得有些麻烦：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DumbJob</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span><span class="token punctuation">&#123;</span>
          <span class="token class-name">JobDataMap</span> dataMap <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getMergedJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
          <span class="token comment">//String jobSays = (String) jobDataMap.get("jobSays");</span>
          <span class="token class-name">String</span> jobSays <span class="token operator">=</span> dataMap<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"jobSays"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">ArrayList</span> state <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token punctuation">)</span>dataMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"myStateData"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
      <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Quartz的默认Job其实只需要你将其Key定义在Job为参数,并设置Setting方法，默认JobFactory在job被实例化的时候会自动调用这些set方法，从而自动装载到参数上去，这样你就不需要在execute()方法中显式地从map中取数据了。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DumbJob</span> <span class="token keyword">implements</span> <span class="token class-name">Job</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> jobSays<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ArrayList</span> state<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">JobDataMap</span> dataMap <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getMergedJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJobSays</span><span class="token punctuation">(</span><span class="token class-name">String</span> jobSays<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jobSays <span class="token operator">=</span> jobSays<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span> state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中在Job执行时，JobExecutionContext 中的<code>JobDataMap</code> 为我们提供了很多的便利，使用<code>getMergedJobDataMap</code>方法直接可以获取到它。</p>
<p>它是<code>JobDetail</code>中的JobDataMap和<code>Trigger</code>中的JobDataMap的并集，但是如果存在相同的数据，则后者会覆盖前者的值。</p>
<h3 id="Trigger"><a href="#Trigger" class="headerlink" title="Trigger"></a>Trigger</h3><p>所有类型的trigger都有TriggerKey这个属性，表示trigger的身份；其中TriggerKey和JobKey的结构一样，由<code>名称</code>和<code>组名</code>组成或者单个<code>名称</code>组成。</p>
<p>除此之外，trigger还有很多其它的公共属性。这些属性，在构建trigger的时候可以通过TriggerBuilder设置。</p>
<ul>
<li><p>优先级(priority)</p>
<p>如果你的trigger很多(或者Quartz线程池的工作线程太少)，Quartz可能没有足够的资源同时触发所有的trigger；这种情况下，你可能希望控制哪些trigger优先使用Quartz的工作线程，要达到该目的，可以在trigger上设置<code>priority</code>属性。比如，你有N个trigger需要同时触发，但只有Z个工作线程，优先级最高的Z个trigger会被首先触发。如果没有为trigger设置优先级，trigger使用默认优先级，值为5；<code>priority</code>属性的值可以是任意整数，正数、负数都可以。</p>
<p>注意：只有同时触发的trigger之间才会比较优先级。10:59触发的trigger总是在11:00触发的trigger之前执行。</p>
</li>
<li><p>错过触发(misfire)</p>
<p>rigger还有一个重要的属性misfire；如果scheduler关闭了，或者Quartz线程池中没有可用的线程来执行job，此时持久性的trigger就会错过(miss)其触发时间，即错过触发(misfire)。不同类型的trigger，有不同的misfire机制。它们默认都使用“智能机制(smart policy)”，即根据trigger的类型和配置动态调整行为。</p>
</li>
</ul>
<h3 id="Quartz持久化"><a href="#Quartz持久化" class="headerlink" title="Quartz持久化"></a>Quartz持久化</h3><p>Quartz提供两种基本定时任务存储。第一种类型叫做RAMJobStore，第二种类型叫做JDBCJobStore。</p>
<p>RamJobStore：顾名思义就是内存持久化存储定时任务，在默认情况下Quartz将任务调度的运行信息保存在内存中，这种方法提供了最佳的性能，但是定时任务实现持久化存储，当程序路途停止或系统崩溃时，所有运行的定时任务都会丢失。</p>
<p>JDBCJobStore：就是通过Java中的JDBC将其数据保存至数据库中，比起内存存储，这种方式会下降性能，但是如果您在主键上构建具有索引的数据库表。在相当现代的一套具有体面的LAN（在调度程序和数据库之间）的机器上，检索和更新触发triggers的时间通常将小于10毫秒。</p>
<p>这里我们实现其Quartz 与Mysql持久化：</p>
<p>因为需要把quartz的数据保存到数据库，所以要建立相关的数据库。这个可以从下载到的quartz包里面找到对应的sql脚本，目前可以支持MySQL，DB2，Oracle等主流的数据库，自己可以根据项目需要选择合适的脚本运行。</p>
<p>1.前往Quartz官方下载完整源码：<a target="_blank" rel="noopener" href="http://www.quartz-scheduler.org/downloads/">http://www.quartz-scheduler.org/downloads/</a></p>
<p>其中SQL文件具体存放在<strong>Quartz的jar包:org/quartz/impl/jdbcjobstore路径下</strong>。</p>
<p>2.将其对应数据库的SQL文件导入数据库中。</p>
<blockquote>
<p>其中各个表的作用（Mysql为例）：</p>
<p>1.qrtz_blob_triggers : 以Blob 类型存储的触发器。<br>2.qrtz_calendars：存放日历信息， quartz可配置一个日历来指定一个时间范围。<br>3.qrtz_cron_triggers：存放cron类型的触发器。<br>4.qrtz_fired_triggers：存放已触发的触发器。<br>5.qrtz_job_details：存放一个jobDetail信息。<br>6.qrtz_job_listeners：job监听器。<br>7.qrtz_locks： 存储程序的悲观锁的信息(假如使用了悲观锁)。<br>8.qrtz_paused_trigger_graps：存放暂停掉的触发器。<br>9.qrtz_scheduler_state：调度器状态。<br>10.qrtz_simple_triggers：简单触发器的信息。<br>11.qrtz_trigger_listeners：触发器监听器。<br>12.qrtz_triggers：触发器的基本信息。</p>
</blockquote>
<p>3.配置Quartz修改属性：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
      
  <span class="token key atrule">quartz</span><span class="token punctuation">:</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">org</span><span class="token punctuation">:</span>
        <span class="token key atrule">quartz</span><span class="token punctuation">:</span>
          <span class="token comment"># 调度器 相关配置</span>
          <span class="token key atrule">scheduler</span><span class="token punctuation">:</span>
            <span class="token key atrule">instanceName</span><span class="token punctuation">:</span> clusteredScheduler  <span class="token comment">#调度标识名 集群中每一个实例都必须使用相同的名称</span>
            <span class="token key atrule">instanceId</span><span class="token punctuation">:</span> AUTO  <span class="token comment">#调度器实例编号自动生成，每个实例不能不能相同</span>
          <span class="token comment"># JobStore 相关配置  </span>
          <span class="token key atrule">jobStore</span><span class="token punctuation">:</span>
            <span class="token key atrule">class</span><span class="token punctuation">:</span> org.quartz.impl.jdbcjobstore.JobStoreTX
            <span class="token key atrule">driverDelegateClass</span><span class="token punctuation">:</span> org.quartz.impl.jdbcjobstore.StdJDBCDelegate
            <span class="token key atrule">tablePrefix</span><span class="token punctuation">:</span> QRTZ_  <span class="token comment"># Quartz 表名前缀,`QRTZ_`是Quartz官方默认前缀</span>
            <span class="token key atrule">isClustered</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># 是否为集群模式</span>
            <span class="token key atrule">clusterCheckinInterval</span><span class="token punctuation">:</span> <span class="token number">10000</span>  <span class="token comment">#分布式节点有效性检查时间间隔，单位：毫秒,默认值是15000</span>
            <span class="token key atrule">useProperties</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
          <span class="token comment"># 线程池相关配置  </span>
          <span class="token key atrule">threadPool</span><span class="token punctuation">:</span>
            <span class="token key atrule">class</span><span class="token punctuation">:</span> org.quartz.simpl.SimpleThreadPool  <span class="token comment"># 线程池类型</span>
            <span class="token key atrule">threadCount</span><span class="token punctuation">:</span> <span class="token number">10</span>  <span class="token comment"># 线程池大小。默认为 10</span>
            <span class="token key atrule">threadPriority</span><span class="token punctuation">:</span> <span class="token number">5</span>  <span class="token comment"># 线程优先级</span>
            <span class="token key atrule">threadsInheritContextClassLoaderOfInitializingThread</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># 数据库存储类型</span>
    <span class="token key atrule">job-store-type</span><span class="token punctuation">:</span> jdbc
    <span class="token key atrule">jdbc</span><span class="token punctuation">:</span>
      <span class="token key atrule">initialize-schema</span><span class="token punctuation">:</span> never <span class="token comment"># 是否自动使用 SQL 初始化 Quartz 表结构。这里设置成 never ，我们手动创建表结构。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="SpringBoot-Quartz集成"><a href="#SpringBoot-Quartz集成" class="headerlink" title="SpringBoot-Quartz集成"></a>SpringBoot-Quartz集成</h2><p>在上面的教程中，我们通通使用了<code>spring-boot-starter-quartz</code>依赖包来使用Quartz，这个依赖包是SpringBoot2.0后Spring官方推出的Quartz整合包。</p>
<p>在SpringBoot2.X后我们可以直接使用<code>spring-boot-starter-quartz</code>来代替之前的<code>quartz</code>和<code>quartz-jobs</code>两个依赖包。</p>
<p>并且还有以下特点：</p>
<ul>
<li><p>无需手动QuartzConfiguration配置类</p>
<p>在之前我们需要手动配置<code>QuartzConfiguration</code>配置类来完成了<code>Quartz</code>需要的一系列配置，如：<code>JobFactory</code>、<code>SchedulerFactoryBean</code>等，在我们添加<code>spring-boot-starter-quartz</code>依赖后就不需要主动声明工厂类，因为<code>spring-boot-starter-quartz</code>已经为我们自动化配置好了。</p>
</li>
<li><p>修改了配置方法</p>
<p>之前的<code>org.quartz.properties</code>配置,在使用<code>spring-boot-starter-quartz</code>依赖后，需要放置在<code>spring.quartz.properties</code>下。</p>
</li>
</ul>
</div>

      <!-- Post Comments -->
      
    <!-- 使用 changyan -->
<div id="changyan-comment">
    <!--PC和WAP自适应版-->
<div id="SOHUCS" sid="2021/12/09/quartZ/"  ></div>
<script type="text/javascript">
(function(){
var appid = 'cyvzq2tmJ';
var conf = 'e61bcf9ca7baef66559e7e33e21fe290';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>

</div>
<style>
    #changyan-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

    </div>
    <!-- Copyright 版权 start -->
    <div id="copyright">
  <ul>
    <li>
      &copy;Powered By
      <a target="_blank" rel="noopener" href="https://hexo.io/" style="border-bottom: none">hexo</a>
    </li>
    <li>Author: <a style="border-bottom: none">@Zssaer</a></li>
  </ul>
  <ul>
    <li>
      <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" id="beian">蜀ICP备2021031070号</a>
    </li>
  </ul>
  
  <span id="busuanzi_container_site_pv"> 2024 </span>
  
</div>

  </div>
  <script>
    const originalTitle = document.title;
    document.title = `QuartZ-定时任务调度工具` + `|` + originalTitle;
  </script>
</body>



 	
</html>
