<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/favicon.png"/>
	<link rel="shortcut icon" href="/img/favicon.png">
	<meta name="baidu-site-verification" content="code-KLcpk3wnwR" />
	
			<title>趙天一ლ(ﾟдﾟლ)You know、You don’t know</title>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, user-scalable=no"
/>
<link rel="stylesheet" href="/css/mic_main.css" />
<link rel="stylesheet" href="/css/dropdownMenu.css" />
<!-- <script src="/js/live2d/autoload.js"></script> -->

<meta name="keywords" content="Zssaer JavaWeb TIANYI ZHAO" />

<noscript>
  <link rel="stylesheet" href="/css/noscript.css" />
</noscript>
<style type="text/css">
  /* body{
    background: url('https://zssaer.oss-cn-chengdu.aliyuncs.com/wallhaven-r7r551.jpg?x-oss-process=style/wallpaper') center 0 no-repeat;
    content: " ";
    position: fixed;
  } */
  body:before {
    content: " ";
    position: fixed;
    top: 0;
    background: url('https://zssaer.oss-cn-chengdu.aliyuncs.com/wallhaven-r7r551.jpg?x-oss-process=style/wallpaper') center 0 no-repeat;

    right: 0;
    bottom: 0;
    left: 0;
    background-size: cover;
  }
</style>

			    

    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.scrollex.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.scrolly.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/skel.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/util.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/main.js"></script>
	
<meta name="generator" content="Hexo 5.4.0"></head>
    
		<!-- Layouts -->


<!--  代码渲染  -->
<script src="/js/prism.js"></script>
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body
  class=""
  data-prismjs-copy="复制"
  data-prismjs-copy-error="请按Ctrl+C手动复制"
  data-prismjs-copy-success="复制成功!"
>
  <div class="mask-border"></div>
  <!-- Wrapper 外包 s-->
  <div id="wrapper" class="fade-in">
    <!-- Intro 头部显示 s -->
    <!-- Intro 头部显示 e -->
    <!-- Header 头部logo start -->
    <header id="header">
    <a href="/" class="logo">Refrain</a>
</header>
    <!-- Nav 导航条 start -->
    <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">Home</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">Categories</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/C/">C++</a></li><li><a class="category-link" href="/categories/JAVA/">JAVA</a></li><li><a class="category-link" href="/categories/Python/">Python</a></li><li><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></li><li><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li><a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></li><li><a class="category-link" href="/categories/%E6%9D%82%E8%B0%88/">杂谈</a></li><li><a class="category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="AboutMe">
		                AboutMe
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="Wallpaper">
		                Wallpaper
		            </a>
		        </li>
		        
		        <li>
		            <a href="/bangumis/" title="Bangumis">
		                Bangumis
		            </a>
		        </li>
		        
						<li class="active">
							<a href="#s1">Other</a>
											<ul class="submenu">
													<li>
													<a class="category-link" href="/another/billiard.html">台球模拟V1.0</a>
												</li>
											</ul>
						</li>

            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/Zssaer" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="git" href="https://gitee.com/Zssaer01" target="_blank" rel="noopener">
                            <i class="icon fa fa-git"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>
    <aside id="toc_menu"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Flyway-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%98%E6%9B%B4%E5%81%9A%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="toc-number">1.</span> <span class="toc-text">Flyway-数据库变更做版本控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">使用教程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.1.</span> <span class="toc-text">建立数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E5%B7%A5%E7%A8%8B%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">建立工程项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEFlyway"><span class="toc-number">1.2.3.</span> <span class="toc-text">配置Flyway</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BASQL%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">1.2.4.</span> <span class="toc-text">创建SQL版本管理文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE%E5%B9%B6%E6%89%A7%E8%A1%8CSQL"><span class="toc-number">1.2.5.</span> <span class="toc-text">运行项目并执行SQL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">高级使用</span></a></li></ol></li></ol></aside>
    <div id="main">
      
      <div
        class="post_page_title_img"
        style="
          height: 25rem;
          background-image: url(https://zssaer.oss-cn-chengdu.aliyuncs.com/wallhaven-573g33.jpg?x-oss-process=style/wallpaper);
          background-position: center;
          background-repeat: no-repeat;
          background-size: cover;
          -moz-background-size: cover;
          overflow: hidden;
        "
      >
        <a href="#" style="padding: 4rem 4rem 2rem 4rem"
          ><h2 id="page-title">Flyway-数据库变更做版本控制</h2></a
        >
      </div>
      
      <button id="toc_button" onclick="openTocSidebar()">文章导航</button>
      <!-- <div id="content_toc">
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Flyway-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%98%E6%9B%B4%E5%81%9A%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6"><span class="toc-number">1.</span> <span class="toc-text">Flyway-数据库变更做版本控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">使用教程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.1.</span> <span class="toc-text">建立数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E5%B7%A5%E7%A8%8B%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">建立工程项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEFlyway"><span class="toc-number">1.2.3.</span> <span class="toc-text">配置Flyway</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BASQL%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">1.2.4.</span> <span class="toc-text">创建SQL版本管理文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE%E5%B9%B6%E6%89%A7%E8%A1%8CSQL"><span class="toc-number">1.2.5.</span> <span class="toc-text">运行项目并执行SQL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">高级使用</span></a></li></ol></li></ol>
            </div>     -->

      <!-- Post -->
      <div class="typo" style="padding: 3rem"><h1 id="Flyway-数据库变更做版本控制"><a href="#Flyway-数据库变更做版本控制" class="headerlink" title="Flyway-数据库变更做版本控制"></a>Flyway-数据库变更做版本控制</h1><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在多人开发的项目中，我们都习惯了使用SVN或者Git来对代码做版本控制，主要的目的就是为了解决多人开发代码冲突和版本回退的问题。</p>
<p>但是对于项目的数据库来说，使用Git或者SVN来进行处理这样十分的不合理。但是数据库又是经常进行修改的地方，经常会出现下面这样情况：</p>
<blockquote>
<p>自己写的SQL忘了在所有环境执行；</p>
<p>别人写的SQL我们不能确定是否都在所有环境执行过了；</p>
<p>有人修改了已经执行过的SQL，期望再次执行；</p>
<p>需要新增环境做数据迁移；</p>
<p>每次发版需要手动控制先发DB版本，再发布应用版本；</p>
</blockquote>
<p>那如何实现对数据库进行版本控制？</p>
<p>在项目中使用Flyway，这些问题都能得到很好的解决。</p>
<p>Flyway是一款可以在您的任何实例中轻松可靠地管理您的数据版本的插件。</p>
<p>它适用于Windows、macOS、Linux、Docker 和 Java</p>
<p>它支持的Maven 和 Gradle 构建工具</p>
<p>它支持的数据库：</p>
<p>Oracle、SQL Server、DB2、MySQL、Aurora MySQL、MariaDB、Percona XtraDB Cluster、PostgreSQL、Aurora PostgreSQL、Redshift、CockroachDB、SAP HANA、Sybase ASE、Informix、H2、HSQLDB、Derby、SQLite、Firebird</p>
<h2 id="使用教程"><a href="#使用教程" class="headerlink" title="使用教程"></a>使用教程</h2><h3 id="建立数据库"><a href="#建立数据库" class="headerlink" title="建立数据库"></a>建立数据库</h3><p>项目开始前我们需要先建立一个项目的数据库，<strong>记住只需要建立一个空的数据库即可，先不要建表。</strong>（因为使用Flyway的项目如果数据库有内容运行会报错）</p>
<h3 id="建立工程项目"><a href="#建立工程项目" class="headerlink" title="建立工程项目"></a>建立工程项目</h3><p>我们按正常Web流程来，建立起Maven项目后，配置好项目的数据库连接，以Mysql为例：</p>
<pre class="line-numbers language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">spring:
  datasource:
    url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;sys?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf8&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai
    username: zssaer
    password: 2222
    driver-class-name: com.mysql.cj.jdbc.Driver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>随后导入FlyWay的Maven依赖：</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.flywaydb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>flyway-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>7.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="配置Flyway"><a href="#配置Flyway" class="headerlink" title="配置Flyway"></a>配置Flyway</h3><p>一般情况下flyway不需要配置,当然对于特殊情况也可以进行自定义配置。</p>
<p>导入Flyway依赖后，在SpringBoot配置文件中配置Flyway：</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#当迁移时发现目标schema非空，而且带有没有元数据的表时，是否自动执行基准迁移，默认false.</span>
spring.flyway.baseline-on-migrate
<span class="token comment">#开始执行基准迁移时对现有的schema的版本打标签，默认值为1.</span>
spring.flyway.baseline-version
<span class="token comment">#检查迁移脚本的位置是否存在，默认false.</span>
spring.flyway.check-location
<span class="token comment">#当发现校验错误时是否自动调用clean，默认false.</span>
spring.flyway.clean-on-validation-error
<span class="token comment">#是否开启flywary，默认true.</span>
spring.flyway.enabled
<span class="token comment">#设置迁移时的编码，默认UTF-8.</span>
spring.flyway.encoding
<span class="token comment">#当读取元数据表时是否忽略错误的迁移，默认false.</span>
spring.flyway.ignore-failed-future-migration
<span class="token comment">#当初始化好连接时要执行的SQL.</span>
spring.flyway.init-sqls
<span class="token comment">#迁移脚本的位置，默认db/migration.</span>
spring.flyway.locations
<span class="token comment">#是否允许无序的迁移，默认false.</span>
spring.flyway.out-of-order
<span class="token comment">#目标数据库的密码.</span>
spring.flyway.password
<span class="token comment">#设定需要flywary迁移的schema，大小写敏感，默认为连接默认的schema.</span>
spring.flyway.schemas
<span class="token comment">#迁移文件的前缀，默认为V.</span>
spring.flyway.sql-migration-prefix
<span class="token comment">#迁移脚本的文件名分隔符，默认__</span>
spring.flyway.sql-migration-separator
<span class="token comment">#迁移脚本的后缀，默认为.sql</span>
spring.flyway.sql-migration-suffix
<span class="token comment">#使用的元数据表名，默认为schema_version</span>
spring.flyway.tableflyway
<span class="token comment">#迁移时使用的目标版本，默认为latest version</span>
spring.flyway.target
<span class="token comment">#迁移时使用的JDBC URL，如果没有指定的话，将使用配置的主数据源</span>
spring.flyway.url
<span class="token comment">#迁移数据库的用户名</span>
spring.flyway.user
<span class="token comment">#迁移时是否校验，默认为true</span>
<span class="token attr-name">spring.flyway.validate-on-migrate</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="创建SQL版本管理文件夹"><a href="#创建SQL版本管理文件夹" class="headerlink" title="创建SQL版本管理文件夹"></a>创建SQL版本管理文件夹</h3><p>默认的FlyWay SQL管理文件夹在项目文件下的resources/db/migration文件夹下，用于存储项目的Sql文件，不管Sql文件是在文件夹外部，还是在版本文件夹也没关系，一样可以识别到：</p>
<p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/5673257-e75ac8a1fa107859.webp"></p>
<p>但是此处的SQL文件 命名需要遵从一定的规范，否则运行的时候flyway会报错。命名规则主要有两种：</p>
<ol>
<li>仅需要被执行一次的SQL命名以大写的”V”开头，后面跟上”0~9”数字的组合,数字之间可以用“.”或者下划线”_”分割开，然后再以两个下划线分割，其后跟文件名称，最后以.sql结尾。比如，<code>V2.1.5__create_user_ddl.sql</code>、<code>V4.1_2__add_user_dml.sql</code>。</li>
<li>可重复运行的SQL，则以大写的“R”开头，后面再以两个下划线分割，其后跟文件名称，最后以.sql结尾。。比如，<code>R__truncate_user_dml.sql</code>。</li>
</ol>
<p><strong>简而言之,使用V开头的Sql文件是项目第一次运行时 进行运行操作的，后续即使在该文件进行修改，也不再进行操作。</strong></p>
<p><strong>而使用R开头的Sql文件是项目运行后 进行判断操作，如果里面有语句没有运行操作过的话，就进行操作。如果都运行过的话就不会进行再次操作。</strong></p>
<p><strong>V开头的SQL执行优先级要比R开头的SQL优先级高。</strong></p>
<p>我们一般将其 表创建和表修改操作的SQL文件以V类文件，而数据插入删除用R类文件。</p>
<h3 id="运行项目并执行SQL"><a href="#运行项目并执行SQL" class="headerlink" title="运行项目并执行SQL"></a>运行项目并执行SQL</h3><p>当我们将其对应的SQL版本文件放置到项目下后，我们运行项目，就会发现FlyWay自动将其Sql文件运行了，数据库也多了对应的数据。</p>
<p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/5673257-6c455d61e1522ff6.webp"></p>
<p>我们还会发现数据库还会多了一个叫<code>flyway_schema_history</code>的数据库:</p>
<p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/image-20211231174958471.png" alt="image-20211231174958471"></p>
<p>这个数据库使用来记录执行的SQl操作的情况的。</p>
<h2 id="高级使用"><a href="#高级使用" class="headerlink" title="高级使用"></a>高级使用</h2><p>上面的都是基于简单的方法使用，每次想要migration都需要运行整个springboot项目，并且只能执行migrate一种命令。</p>
<p>FlyWay还给我们通过了高级的Maven使用：</p>
<p>在Maven中配置：</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.flywaydb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>flyway-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.2.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>jdbc:mysql://localhost:3306/flyway?useUnicode=true<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=utf8<span class="token entity named-entity" title="&amp;">&amp;amp;</span>serverTimezone=GMT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>
                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span>
                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span>
                 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>driver</span><span class="token punctuation">></span></span>com.mysql.cj.jdbc.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>driver</span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后更新maven插件列表，就可以看到flyway的全部命令了。</p>
<p><img src="https://zssaer.oss-cn-chengdu.aliyuncs.com/20211231174209.png"></p>
<p>其中命名效果如下:</p>
<blockquote>
<p>baseline</p>
<p>对已经存在数据库Schema结构的数据库一种解决方案。实现在非空数据库新建MetaData表，并把Migrations应用到该数据库；也可以在已有表结构的数据库中实现添加Metadata表。</p>
<p>clean</p>
<p>清除掉对应数据库Schema中所有的对象，包括表结构，视图，存储过程等，clean操作在dev 和 test阶段很好用，但在生产环境务必禁用。</p>
<p>info</p>
<p>用于打印所有的Migrations的详细和状态信息，也是通过MetaData和Migrations完成的，可以快速定位当前的数据库版本。</p>
<p>repair</p>
<p>repair操作能够修复metaData表，该操作在metadata出现错误时很有用。</p>
<p>undo</p>
<p>撤销操作，社区版不支持。</p>
<p>validate</p>
<p>验证已经apply的Migrations是否有变更，默认开启的，原理是对比MetaData表与本地Migrations的checkNum值，如果值相同则验证通过，否则失败。</p>
</blockquote>
<p>至于<code>flyway:migrate</code>则是和上面的项目运行效果一样的。</p>
<p>下面是一些下操作经验分享：</p>
<p>对于已经有数据的数据库，必须先baseline，然后才能migrate；</p>
<p>clean操作是删除数据库的所有内容，包括baseline之前的内容；</p>
<p>尽量不要修改已经执行过的SQL，即便是R开头的可反复执行的SQL，它们会不利于数据迁移；</p>
<p><strong>对于任何后续更新操作错误，可以先使用repair<code>操作清空 </code>flyway_schema_history<code>数据库记录，再执行</code>flyway:migrate 操作</strong></p>
</div>

      <!-- Post Comments -->
      
    <!-- 使用 changyan -->
<div id="changyan-comment">
    <!--PC和WAP自适应版-->
<div id="SOHUCS" sid="2021/12/31/flyway/"  ></div>
<script type="text/javascript">
(function(){
var appid = 'cyvzq2tmJ';
var conf = 'e61bcf9ca7baef66559e7e33e21fe290';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>

</div>
<style>
    #changyan-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

    </div>
    <!-- Copyright 版权 start -->
    <div id="copyright">
  <ul>
    <li>
      &copy;Powered By
      <a target="_blank" rel="noopener" href="https://hexo.io/" style="border-bottom: none">hexo</a>
    </li>
    <li>Author: <a style="border-bottom: none">@Zssaer</a></li>
  </ul>
  <ul>
    <li>
      <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" id="beian">蜀ICP备2021031070号</a>
    </li>
  </ul>
  
  <span id="busuanzi_container_site_pv"> 2024 </span>
  
</div>

  </div>
  <script>
    const originalTitle = document.title;
    document.title = `Flyway-数据库变更做版本控制` + `|` + originalTitle;
  </script>
</body>



 	
</html>
