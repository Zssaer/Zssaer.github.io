<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/favicon.png"/>
	<link rel="shortcut icon" href="/img/favicon.png">
	<meta name="baidu-site-verification" content="code-KLcpk3wnwR" />
	
			<title>趙天一ლ(ﾟдﾟლ)You know、You don’t know</title>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, user-scalable=no"
/>
<link rel="stylesheet" href="/css/mic_main.css" />
<link rel="stylesheet" href="/css/dropdownMenu.css" />
<!-- <script src="/js/live2d/autoload.js"></script> -->

<meta name="keywords" content="Zssaer JavaWeb TIANYI ZHAO" />

<noscript>
  <link rel="stylesheet" href="/css/noscript.css" />
</noscript>
<style type="text/css">
  /* body{
    background: url('https://zssaer.oss-cn-chengdu.aliyuncs.com/wallhaven-r7r551.jpg?x-oss-process=style/wallpaper') center 0 no-repeat;
    content: " ";
    position: fixed;
  } */
  body:before {
    content: " ";
    position: fixed;
    top: 0;
    background: url('https://zssaer.oss-cn-chengdu.aliyuncs.com/wallhaven-r7r551.jpg?x-oss-process=style/wallpaper') center 0 no-repeat;

    right: 0;
    bottom: 0;
    left: 0;
    background-size: cover;
  }
</style>

			    

    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.scrollex.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/jquery.scrolly.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/skel.min.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/util.js"></script>
    <script src="https://zssaer.oss-cn-chengdu.aliyuncs.com/main.js"></script>
	
<meta name="generator" content="Hexo 5.4.0"></head>
    
		<!-- Layouts -->


<!--  代码渲染  -->
<script src="/js/prism.js"></script>
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body
  class=""
  data-prismjs-copy="复制"
  data-prismjs-copy-error="请按Ctrl+C手动复制"
  data-prismjs-copy-success="复制成功!"
>
  <div class="mask-border"></div>
  <!-- Wrapper 外包 s-->
  <div id="wrapper" class="fade-in">
    <!-- Intro 头部显示 s -->
    <!-- Intro 头部显示 e -->
    <!-- Header 头部logo start -->
    <header id="header">
    <a href="/" class="logo">Refrain</a>
</header>
    <!-- Nav 导航条 start -->
    <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">Home</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">Categories</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/C/">C++</a></li><li><a class="category-link" href="/categories/JAVA/">JAVA</a></li><li><a class="category-link" href="/categories/Python/">Python</a></li><li><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></li><li><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li><a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></li><li><a class="category-link" href="/categories/%E6%9D%82%E8%B0%88/">杂谈</a></li><li><a class="category-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="AboutMe">
		                AboutMe
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="Wallpaper">
		                Wallpaper
		            </a>
		        </li>
		        
		        <li>
		            <a href="/bangumis/" title="Bangumis">
		                Bangumis
		            </a>
		        </li>
		        
						<li class="active">
							<a href="#s1">Other</a>
											<ul class="submenu">
													<li>
													<a class="category-link" href="/another/billiard.html">台球模拟V1.0</a>
												</li>
											</ul>
						</li>

            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/Zssaer" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="git" href="https://gitee.com/Zssaer01" target="_blank" rel="noopener">
                            <i class="icon fa fa-git"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>
    <aside id="toc_menu"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-AOP"><span class="toc-number">1.</span> <span class="toc-text">Spring-AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">基础使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E5%88%9B%E5%BB%BA%E5%88%87%E9%9D%A2%E7%B1%BB"><span class="toc-number">1.3.1.</span> <span class="toc-text">一.创建切面类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E5%AE%9A%E4%B9%89%E5%88%87%E5%85%A5%E7%82%B9"><span class="toc-number">1.3.2.</span> <span class="toc-text">二.定义切入点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">切入点表达式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-%E5%AE%9A%E4%B9%89%E5%A2%9E%E5%BC%BA"><span class="toc-number">1.3.3.</span> <span class="toc-text">三.定义增强</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JoinPoint%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">JoinPoint对象</span></a></li></ol></li></ol></li></ol></li></ol></aside>
    <div id="main">
      
      <div
        class="post_page_title_img"
        style="
          height: 25rem;
          background-image: url(https://zssaer.oss-cn-chengdu.aliyuncs.com/wallhaven-g71pve.jpg?x-oss-process=style/wallpaper);
          background-position: center;
          background-repeat: no-repeat;
          background-size: cover;
          -moz-background-size: cover;
          overflow: hidden;
        "
      >
        <a href="#" style="padding: 4rem 4rem 2rem 4rem"
          ><h2 id="page-title">Spring-AOP</h2></a
        >
      </div>
      
      <button id="toc_button" onclick="openTocSidebar()">文章导航</button>
      <!-- <div id="content_toc">
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-AOP"><span class="toc-number">1.</span> <span class="toc-text">Spring-AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">基础使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E5%88%9B%E5%BB%BA%E5%88%87%E9%9D%A2%E7%B1%BB"><span class="toc-number">1.3.1.</span> <span class="toc-text">一.创建切面类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E5%AE%9A%E4%B9%89%E5%88%87%E5%85%A5%E7%82%B9"><span class="toc-number">1.3.2.</span> <span class="toc-text">二.定义切入点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">切入点表达式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-%E5%AE%9A%E4%B9%89%E5%A2%9E%E5%BC%BA"><span class="toc-number">1.3.3.</span> <span class="toc-text">三.定义增强</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JoinPoint%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">JoinPoint对象</span></a></li></ol></li></ol></li></ol></li></ol>
            </div>     -->

      <!-- Post -->
      <div class="typo" style="padding: 3rem"><h1 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring-AOP"></a>Spring-AOP</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>AOP-全程”Aspect Orient Programming”，中文叫做“面向切面编程”，可以说它是OOP“面向对象编程”的补充和完善。</p>
<p>传统OOP思想中，引入封装、继承和多态性等概念来建立一种对象层次模型结构Class，允许你定义从上到下的关系，但并不适合定义从左到右的关系。例如日志功能。日志代码往往水平地散布在所有对象层次中，而与它所散布到的对象的核心功能毫无关系，要求在操作每一步中进行记录，这时利用OOP设计的话，就会在每一步中进行记录操作，从而导致大量的代码重复。</p>
<p>而AOP技术则恰恰相反，它利用一种称为“横切”的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其名为“Aspect”，这种编程思想极大的减少了代码重复使用。</p>
<p>AOP思想和实现多用于日志记录、权限授权、事务处理等这样的行为前后执行内容上。</p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>全局：</p>
<ul>
<li><p>aspect（切面）：类似于OOP中的Class，一个Aspect存放一个系统功能的所有逻辑；在ApplicationContext中aop:aspect来配置；</p>
</li>
<li><p>连接点（Joinpoint）：程序执行过程中的某一事件，如方法被调用时、抛出异常时；<strong>SpringAOP仅支持方法的连接点</strong>，既仅能在方法调用前，方法调用后，方法抛出异常时等这些程序执行点进行操作。比如一个拥有两个方法的类，这两个方法都会是连接点。</p>
<p>类似于OOP中类中的方法。</p>
</li>
</ul>
<p>实际操作：</p>
<ul>
<li>切入点（Pointcut）：类似于过滤器，一个表达式，用于<strong>确定哪些类的哪些方法需要插入横切逻辑</strong>；比如当某个连接点满足指定要求时，就可以被添加Advice，成为切入点。如何使用表达式定义切入点，是AOP的核心。</li>
<li>增强（Advice）：<strong>切点上的具体执行逻辑</strong>；Spring中有四种Advice：Before（前置）、After（后置）、Around（环绕）、After Throwing（抛出异常后）。</li>
<li>目标对象（Target）：被AOP框架进行增强处理的对象。如果是动态AOP的框架，则对象是一个被代理的对象。</li>
</ul>
<h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2><p>目前最流行的AspectJ，在Spring默认使用<strong>AspectJ</strong>切入点，需要导入依赖包：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> aspectjweaver <span class="token operator">--</span><span class="token operator">></span>
<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>aspectj<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>aspectjweaver<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">1.9</span><span class="token number">.4</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中aspectjweaver是aspectj的织入包；一般简单AOP的话，只需要导入这个包即可。</p>
<h3 id="一-创建切面类"><a href="#一-创建切面类" class="headerlink" title="一.创建切面类"></a>一.创建切面类</h3><p>创建一个Aspect组件类，并添加为<code>@Aspect</code>注解，表示该类为切面类。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * @description: 普通切面类
 * @author: Zhaotianyi
 * @time: 2021/10/18 15:41
 */</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonAspect</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">CommonAspect</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="二-定义切入点"><a href="#二-定义切入点" class="headerlink" title="二.定义切入点"></a>二.定义切入点</h3><p>在其组件类中定义切入点（PointCut），用作于指定的XXX行为下。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 定义切入点,表示匹配com.admin.provider包及其子包下的所有类中的公共方法
 */</span>
<span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(public * com.admin.provider..*.*(..))"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">webLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="切入点表达式"><a href="#切入点表达式" class="headerlink" title="切入点表达式"></a>切入点表达式</h4><p>其中<code>@Pointcut</code>注解中的值为判断表达式，用来匹配指定方法，内容为:<code>表达标签 （ 表达式格式)</code>。</p>
<p>其中表达标签有：</p>
<blockquote>
<ul>
<li>execution()：用于直接匹配方法执行的连接点</li>
<li>args(): 用于匹配当前执行的方法传入的参数为指定类型的执行方法</li>
<li>this(): 用于匹配当前AOP代理对象类型的执行方法；注意是AOP代理对象的类型匹配，这样就可能包括引入接口也类型匹配；</li>
<li>target(): 用于匹配当前目标对象类型的执行方法；注意是目标对象的类型匹配，这样就不包括引入接口也类型匹配；</li>
<li>within(): 用于匹配指定类型内的方法执行；</li>
<li>@args():于匹配当前执行的方法传入的参数持有指定注解的执行；</li>
<li>@target():用于匹配当前目标对象类型的执行方法，其中目标对象持有指定的注解；</li>
<li>@within():用于匹配所以持有指定注解类型内的方法；</li>
<li>@annotation():用于匹配当前执行方法持有指定注解的方法；</li>
</ul>
</blockquote>
<p>其中<code>execution</code> 是用的最多的,而其表达式格式为:</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">modifier-pattern? ret-type-pattern declaring-type-pattern? name-pattern(param-pattern) throws-pattern?<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<ul>
<li><p>modifier-pattern? 修饰符匹配，如public 表示匹配公有方法</p>
</li>
<li><p>ret-type-pattern 返回值匹配，* 表示任何返回值,全路径的类名等</p>
</li>
<li><p>declaring-type-pattern? 类路径匹配</p>
</li>
<li><p>name-pattern 方法名匹配，* 代表所有,set*,代表以set开头的所有方法</p>
</li>
<li><p>(param-pattern) 参数匹配，指定方法参数(声明的类型)</p>
<p>(..)代表所有参数</p>
<p>()代表一个参数</p>
<p>(,String)代表第一个参数为任何值,第二个为String类型</p>
</li>
<li><p>throws-pattern? 异常类型匹配</p>
</li>
</ul>
</blockquote>
<p>其中带末尾?号的 modifiers-pattern?，declaring-type-pattern?，hrows-pattern?是可选项</p>
<blockquote>
<p>例如:</p>
<p>execution(public * <em>(..)) 定义任意公共方法的执行<br>execution(</em> set*(..)) 定义任何一个以”set”开始的方法的执行<br>execution(* com.xyz.service.AccountService.<em>(..)) 定义AccountService 接口的任意方法的执行<br>execution(</em> com.xyz.service.<em>.</em>(..)) 定义在service包里的任意方法的执行<br>execution(* com.xyz.service ..<em>.</em>(..)) 定义在service包和所有子包里的任意类的任意方法的执行</p>
</blockquote>
<p><code>@annotation</code>是方法注释的匹配,而<code>@within</code>和<code>@target</code>是对类注解的匹配:</p>
<blockquote>
<p>@annotation(org.springframework.transaction.annotation.Transactional) 表示带有@Transactional标注的任意方法.</p>
<p>@within(org.springframework.transaction.annotation.Transactional) 表示带有@Transactional标注的所有类的任意方法.</p>
<p>@target(org.springframework.transaction.annotation.Transactional) 表示带有@Transactional标注的所有类的任意方法.</p>
</blockquote>
<h3 id="三-定义增强"><a href="#三-定义增强" class="headerlink" title="三.定义增强"></a>三.定义增强</h3><p>在其组件类中定义增强（Advice），用作每个切入点的执行逻辑。</p>
<p>其中Advice在AspectJ中类型有 before、after 和 around、After Throwing，分别表示“前置执行”、“后置执行”、“环绕执行”、“抛出异常后执行”等。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 切入点的前置执行
 */</span>
<span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"webLog()"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doBefore</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 执行的逻辑</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面定义了一个webLog()的切入点方法名 的前置执行Advice。</p>
<p>由上面的切入点定义，最终的结果为 <code>运行com.admin.provider包及其子包下的任一类的公共方法,都会提前执行doBefore中的逻辑行为</code>。</p>
<h4 id="JoinPoint对象"><a href="#JoinPoint对象" class="headerlink" title="JoinPoint对象"></a>JoinPoint对象</h4><p>其中你可能会注意到方法的函数有一个<code>JoinPoint</code>参数，这又是什么呢？</p>
<p><strong>JoinPoint</strong>对象封装了SpringAop中切面方法的信息，通常用它来获取相关切入点的信息<br><strong>它的常用api:</strong></p>
<table>
<thead>
<tr>
<th align="left">方法名</th>
<th align="left">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Signature getSignature();</td>
<td align="left"><em><strong>获取封装了署名信息的对象,在该对象中可以获取到目标方法名,所属类的Class等信息</strong></em></td>
</tr>
<tr>
<td align="left">Object[] getArgs();</td>
<td align="left"><strong>获取传入目标方法的参数对象</strong></td>
</tr>
<tr>
<td align="left">Object getTarget();</td>
<td align="left"><strong>获取被代理的对象</strong></td>
</tr>
<tr>
<td align="left">Object getThis();</td>
<td align="left"><strong>获取代理对象</strong></td>
</tr>
</tbody></table>
<p>获取到的<code>Signature </code>通常用于跟踪或记录应用程序以获取有关连接点的反射信息。比如如下操作：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"目标方法名为:"</span> <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"目标方法所在的类的类名:"</span> <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getDeclaringTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"目标方法的访问修饰符:"</span> <span class="token operator">+</span> <span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>signature<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>通常这样得到的Signature可以强制转换为MethodSignature对象，<code>MethodSignature</code>相较于普通<code>Signature</code>对象,额外多了两个方法,可以方便直接获取方法：</p>
<table>
<thead>
<tr>
<th align="left">方法名</th>
<th align="left">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Class getReturnType()</td>
<td align="left"><strong>获取切入点方法返回对象的类型Class</strong></td>
</tr>
<tr>
<td align="left">Method getMethod();</td>
<td align="left"><strong>获取切入点方法对象</strong></td>
</tr>
</tbody></table>
<p><code>ProceedingJoinPoint</code>对象是JoinPoint的子接口,该对象只能用在<code>@Around</code>的切面增强方法参数中。</p>
<p>还有一种特别的JointPoint对象，<code>ProceedingJoinPoint</code>对象是JoinPoint的子接口,该对象只能用在@Around的切面增强方法参数中。它相较于<code>ProceedingJoinPoint</code>添加了 两个不一样的方法:</p>
<table>
<thead>
<tr>
<th align="left">方法名</th>
<th align="left">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Object proceed()</td>
<td align="left">执行目标方法</td>
</tr>
<tr>
<td align="left">Object proceed(Object[] var1)</td>
<td align="left">传入的新的参数去执行目标方法</td>
</tr>
</tbody></table>
<p>要解析这里面的<code>执行目标方法</code>的话，则要先了解<code>@Around</code>这个切面增强：</p>
<p><code>@Around</code>所谓环绕执行，它的作用为：</p>
<ul>
<li><strong>既可以在目标方法之前织入增强动作，也可以在执行目标方法之后织入增强动作；</strong></li>
<li><strong>可以决定目标方法在什么时候执行，如何执行，甚至可以完全阻止目标目标方法的执行；</strong></li>
<li><strong>可以改变执行目标方法的参数值，也可以改变执行目标方法之后的返回值； 所以当需要改变目标方法的返回值时，只能使用Around方法；</strong></li>
</ul>
<p><strong>但是注意虽然Around功能强大，但通常需要在线程安全的环境下使用。</strong>因此，如果使用普通的Before、AfterReturing增强方法就可以解决的事情，就没有必要使用Around增强处理了。</p>
<p>回顾过来，ProceedingJoinPoint中的proceed执行方法，即为执行切入点方法的内容。其返回值Object为切入点方法的返回值。在判断条件后可以强制转化。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"logPointCut()"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> point<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">long</span> beginTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//执行方法</span>
    <span class="token class-name">Object</span> result <span class="token operator">=</span> point<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> result1 <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//执行时长(毫秒)</span>
    <span class="token keyword">long</span> time <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> beginTime<span class="token punctuation">;</span>
    <span class="token comment">//保存日志</span>
    <span class="token function">saveSysLog</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> time<span class="token punctuation">,</span> jsonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面这个例截取于常见的日志记录AOP。</p>
<p>一个切入点可以有多个增强设置。</p>
</div>

      <!-- Post Comments -->
      
    <!-- 使用 changyan -->
<div id="changyan-comment">
    <!--PC和WAP自适应版-->
<div id="SOHUCS" sid="2021/12/27/SpringbootAop/"  ></div>
<script type="text/javascript">
(function(){
var appid = 'cyvzq2tmJ';
var conf = 'e61bcf9ca7baef66559e7e33e21fe290';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>

</div>
<style>
    #changyan-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

    </div>
    <!-- Copyright 版权 start -->
    <div id="copyright">
  <ul>
    <li>
      &copy;Powered By
      <a target="_blank" rel="noopener" href="https://hexo.io/" style="border-bottom: none">hexo</a>
    </li>
    <li>Author: <a style="border-bottom: none">@Zssaer</a></li>
  </ul>
  <ul>
    <li>
      <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" id="beian">蜀ICP备2021031070号</a>
    </li>
  </ul>
  
  <span id="busuanzi_container_site_pv"> 2024 </span>
  
</div>

  </div>
  <script>
    const originalTitle = document.title;
    document.title = `Spring-AOP` + `|` + originalTitle;
  </script>
</body>



 	
</html>
